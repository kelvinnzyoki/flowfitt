<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Program - FlowFit</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=DM+Sans:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root{--g1:linear-gradient(135deg,#667eea,#764ba2);--g2:linear-gradient(135deg,#f093fb,#f5576c);--g3:linear-gradient(135deg,#4facfe,#00f2fe);--ga:linear-gradient(135deg,#fa709a,#fee140);--dark:#0a0a0f;--card:#1a1a24;--sid:#0f0f16;--p:#ffffff;--s:#a8a8b8;--acc:#f5576c;--green:#4ade80;--border:rgba(255,255,255,0.06);--mono:'JetBrains Mono',monospace;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'DM Sans',sans-serif;background:var(--dark);color:var(--p);min-height:100vh;overflow-x:hidden;}
        .sidebar{width:260px;background:var(--sid);border-right:1px solid var(--border);padding:2rem 1.5rem;display:flex;flex-direction:column;position:fixed;height:100vh;overflow-y:auto;z-index:100;}
        .logo{font-family:'Archivo Black',sans-serif;font-size:1.8rem;background:var(--ga);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:3rem;}
        .nav-menu{list-style:none;flex:1;}.nav-item{margin-bottom:.4rem;}
        .nav-link{display:flex;align-items:center;gap:1rem;padding:.9rem 1.1rem;color:var(--s);text-decoration:none;border-radius:12px;transition:all .3s;font-weight:500;font-size:.95rem;}
        .nav-link:hover{background:rgba(255,255,255,.05);color:var(--p);}
        .nav-link.active{background:var(--g2);color:#fff;}
        .nav-icon{font-size:1.3rem;}
        .user-profile{display:flex;align-items:center;gap:1rem;padding:1.1rem;background:rgba(255,255,255,.03);border-radius:14px;margin-top:auto;}
        .user-avatar{width:42px;height:42px;border-radius:50%;background:var(--g1);display:flex;align-items:center;justify-content:center;font-weight:700;}
        .user-info h4{font-weight:700;font-size:.9rem;}.user-info p{color:var(--s);font-size:.8rem;}
        .main{margin-left:260px;min-height:100vh;}
        .hero{height:340px;position:relative;display:flex;align-items:flex-end;overflow:hidden;}
        .hero-bg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:9rem;}
        .hero-overlay{position:absolute;inset:0;background:linear-gradient(to top,var(--dark) 5%,rgba(0,0,0,.4) 60%,transparent);}
        .hero-content{position:relative;z-index:1;padding:2.5rem 3rem;width:100%;}
        .breadcrumb{display:flex;align-items:center;gap:.6rem;color:var(--s);font-size:.9rem;margin-bottom:1rem;}
        .breadcrumb a{color:rgba(255,255,255,.6);text-decoration:none;}.breadcrumb a:hover{color:var(--p);}
        .hero-badge{display:inline-flex;align-items:center;gap:.5rem;padding:.45rem 1rem;background:rgba(255,255,255,.12);backdrop-filter:blur(10px);border-radius:50px;font-size:.75rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;margin-bottom:.75rem;}
        .hero-title{font-family:'Archivo Black',sans-serif;font-size:3rem;letter-spacing:-2px;line-height:1;margin-bottom:.75rem;}
        .hero-desc{color:rgba(255,255,255,.75);max-width:600px;line-height:1.7;margin-bottom:1.5rem;font-size:1rem;}
        .hero-stats{display:flex;gap:2.5rem;}
        .hero-stat .val{font-family:var(--mono);font-size:1.6rem;font-weight:700;display:block;}
        .hero-stat .lbl{color:rgba(255,255,255,.5);font-size:.78rem;text-transform:uppercase;letter-spacing:.5px;}
        .body{padding:2rem 3rem;display:grid;grid-template-columns:1fr 340px;gap:2.5rem;}
        .progress-panel{position:sticky;top:2rem;display:flex;flex-direction:column;gap:1.5rem;}
        .panel-card{background:var(--card);border-radius:20px;border:1px solid var(--border);padding:1.75rem;}
        .panel-title{font-family:'Archivo Black',sans-serif;font-size:1.2rem;margin-bottom:1.25rem;}
        .prog-ring-wrap{position:relative;width:140px;height:140px;margin:0 auto 1.25rem;}
        .prog-svg{transform:rotate(-90deg);}
        .prog-bg{fill:none;stroke:rgba(255,255,255,.06);stroke-width:10;}
        .prog-fill{fill:none;stroke:url(#progGrad);stroke-width:10;stroke-linecap:round;transition:stroke-dashoffset 1s ease;}
        .prog-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
        .prog-pct{font-family:var(--mono);font-size:1.8rem;font-weight:700;}.prog-lbl{font-size:.75rem;color:var(--s);}
        .prog-stats{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-bottom:1.25rem;}
        .prog-stat{background:rgba(255,255,255,.03);border-radius:12px;padding:.9rem;text-align:center;border:1px solid var(--border);}
        .prog-stat .v{font-family:var(--mono);font-size:1.2rem;font-weight:700;color:var(--acc);}.prog-stat .l{font-size:.75rem;color:var(--s);margin-top:.2rem;}
        .btn-continue{width:100%;padding:1.1rem;background:var(--ga);color:#000;border:none;border-radius:14px;font-weight:700;font-size:1rem;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .3s;margin-bottom:.75rem;}
        .btn-continue:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(245,87,108,.3);}
        .btn-continue:disabled{opacity:.5;cursor:not-allowed;transform:none;}
        .btn-enroll{width:100%;padding:1.1rem;background:var(--ga);color:#000;border:none;border-radius:14px;font-weight:700;font-size:1rem;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .3s;}
        .btn-enroll:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(245,87,108,.3);}
        .includes-grid{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-bottom:1.5rem;}
        .include-item{padding:1rem;background:rgba(255,255,255,.03);border-radius:14px;border:1px solid var(--border);display:flex;align-items:center;gap:.75rem;}
        .include-icon{font-size:1.4rem;}.include-text h4{font-weight:700;font-size:.9rem;}.include-text p{color:var(--s);font-size:.8rem;margin-top:.1rem;}
        .week-block{background:var(--card);border-radius:20px;border:1px solid var(--border);margin-bottom:1.25rem;overflow:hidden;}
        .week-header{padding:1.4rem 1.75rem;display:flex;align-items:center;gap:1rem;cursor:pointer;transition:background .2s;user-select:none;}
        .week-header:hover,.week-header.open{background:rgba(255,255,255,.03);}
        .week-num{width:38px;height:38px;border-radius:10px;background:var(--g2);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem;flex-shrink:0;}
        .week-info{flex:1;}.week-title{font-weight:700;font-size:.95rem;margin-bottom:.15rem;}.week-meta{color:var(--s);font-size:.82rem;}
        .week-chevron{color:var(--s);font-size:1.1rem;transition:transform .3s;}
        .week-header.open .week-chevron{transform:rotate(180deg);}
        .week-progress-bar{height:3px;background:rgba(255,255,255,.04);}
        .week-progress-fill{height:100%;background:var(--g2);transition:width .6s ease;}
        .week-body{display:none;padding:0 1.5rem 1.5rem;}.week-body.open{display:block;}
        .day-row{display:flex;align-items:center;gap:1rem;padding:.9rem 1rem;background:rgba(255,255,255,.02);border-radius:14px;margin-bottom:.5rem;border:1px solid transparent;transition:all .3s;}
        .day-row:last-child{margin-bottom:0;}
        .day-row.current-day{border-color:rgba(245,87,108,.3);background:rgba(245,87,108,.05);}
        .day-row.completed-day{border-color:rgba(74,222,128,.15);background:rgba(74,222,128,.03);}
        .day-num{width:34px;height:34px;border-radius:50%;background:rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.82rem;flex-shrink:0;}
        .day-row.current-day .day-num{background:var(--g2);}.day-row.completed-day .day-num{background:rgba(74,222,128,.2);color:var(--green);}
        .day-info{flex:1;min-width:0;}.day-title{font-weight:600;font-size:.9rem;margin-bottom:.3rem;}
        .day-exercises{display:flex;gap:.35rem;flex-wrap:wrap;}
        .ex-chip{padding:.2rem .6rem;background:rgba(255,255,255,.06);border-radius:50px;font-size:.73rem;color:var(--s);}
        .day-status{flex-shrink:0;}
        .status-done{color:var(--green);font-size:1.1rem;}
        .status-current{padding:.4rem .9rem;background:var(--acc);color:#fff;border:none;border-radius:50px;font-size:.78rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s;white-space:nowrap;}
        .status-current:hover{transform:scale(1.05);box-shadow:0 4px 15px rgba(245,87,108,.4);}
        .status-locked{color:rgba(255,255,255,.2);font-size:1rem;}
        .wmodal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(12px);z-index:500;align-items:center;justify-content:center;padding:1.5rem;}
        .wmodal.active{display:flex;}
        .wmodal-box{background:var(--card);border-radius:24px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto;border:1px solid rgba(255,255,255,.08);}
        .wm-hero{height:150px;display:flex;align-items:center;justify-content:center;font-size:5rem;border-radius:24px 24px 0 0;}
        .wm-body{padding:1.75rem;}
        .wm-title{font-family:'Archivo Black',sans-serif;font-size:1.7rem;margin-bottom:.3rem;}
        .wm-meta{color:var(--s);font-size:.88rem;margin-bottom:1.25rem;display:flex;gap:1rem;}
        .wm-desc{color:var(--s);line-height:1.7;margin-bottom:1.25rem;font-size:.92rem;}
        .wm-steps{list-style:none;margin-bottom:1.5rem;}
        .wm-step{display:flex;gap:.75rem;padding:.7rem 0;border-bottom:1px solid var(--border);}
        .wm-step:last-child{border-bottom:none;}
        .wm-step-n{width:26px;height:26px;border-radius:50%;background:var(--g2);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.78rem;flex-shrink:0;}
        .wm-step-t{color:var(--s);line-height:1.6;font-size:.88rem;padding-top:.1rem;}
        .wm-actions{display:flex;gap:.75rem;}
        .btn-start-session{flex:2;padding:1rem;background:var(--ga);color:#000;border:none;border-radius:14px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.95rem;transition:all .3s;}
        .btn-start-session:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(245,87,108,.3);}
        .btn-close-wm{flex:1;padding:1rem;background:rgba(255,255,255,.05);color:var(--p);border:1px solid var(--border);border-radius:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;}
        @media(max-width:900px){.sidebar{display:none;}.main{margin-left:0;}.hero-content{padding:1.5rem;}.hero-title{font-size:2rem;}.body{grid-template-columns:1fr;padding:1.5rem;}.progress-panel{position:static;}.hero-stats{gap:1.5rem;}}
    </style>
</head>
<body>
<aside class="sidebar">
    <div class="logo">FlowFit</div>
    <ul class="nav-menu">
        <li class="nav-item"><a href="dashboard.html" class="nav-link"><span class="nav-icon">üìä</span><span>Dashboard</span></a></li>
        <li class="nav-item"><a href="workouts.html" class="nav-link"><span class="nav-icon">üí™</span><span>Workouts</span></a></li>
        <li class="nav-item"><a href="programs.html" class="nav-link active"><span class="nav-icon">üìã</span><span>Programs</span></a></li>
        <li class="nav-item"><a href="progress.html" class="nav-link"><span class="nav-icon">üìà</span><span>Progress</span></a></li>
        <li class="nav-item"><a href="#" class="nav-link"><span class="nav-icon">üèÜ</span><span>Achievements</span></a></li>
        <li class="nav-item"><a href="#" class="nav-link"><span class="nav-icon">üí≥</span><span>Subscription</span></a></li>
        <li class="nav-item"><a href="#" class="nav-link"><span class="nav-icon">‚öôÔ∏è</span><span>Settings</span></a></li>
    </ul>
    <div class="user-profile">
        <div class="user-avatar">?</div>
        <div class="user-info"><h4>Loading...</h4><p>Member</p></div>
    </div>
</aside>
<div class="main">
    <div class="hero">
        <div class="hero-bg" id="heroBg">üí™</div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <div class="breadcrumb"><a href="programs.html">‚Üê Programs</a><span>/ <span id="bcTitle">Program</span></span></div>
            <div class="hero-badge" id="heroBadge">‚ö° Program</div>
            <h1 class="hero-title" id="heroTitle">Loading...</h1>
            <p class="hero-desc" id="heroDesc"></p>
            <div class="hero-stats">
                <div class="hero-stat"><span class="val" id="hsDuration">‚Äî</span><span class="lbl">Weeks</span></div>
                <div class="hero-stat"><span class="val" id="hsDays">‚Äî</span><span class="lbl">Days/Week</span></div>
                <div class="hero-stat"><span class="val" id="hsSessions">‚Äî</span><span class="lbl">Total Sessions</span></div>
            </div>
        </div>
    </div>
    <div class="body">
        <div>
            <div style="background:var(--card);border-radius:20px;border:1px solid var(--border);padding:1.75rem;margin-bottom:1.75rem;">
                <h2 style="font-family:'Archivo Black',sans-serif;font-size:1.25rem;margin-bottom:1.25rem;">What's Included</h2>
                <div class="includes-grid" id="includesGrid"></div>
            </div>
            <h2 style="font-family:'Archivo Black',sans-serif;font-size:1.5rem;margin-bottom:1.25rem;">Weekly Plan</h2>
            <div id="weeksContainer"><p style="color:var(--s)">Loading...</p></div>
        </div>
        <div class="progress-panel">
            <div class="panel-card">
                <div class="panel-title" id="panelTitle">Your Progress</div>
                <div class="prog-ring-wrap">
                    <svg class="prog-svg" width="140" height="140" viewBox="0 0 140 140">
                        <defs><linearGradient id="progGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fa709a"/><stop offset="100%" stop-color="#fee140"/></linearGradient></defs>
                        <circle class="prog-bg" cx="70" cy="70" r="60"/>
                        <circle class="prog-fill" id="progRingFill" cx="70" cy="70" r="60" stroke-dasharray="376.99" stroke-dashoffset="376.99"/>
                    </svg>
                    <div class="prog-inner"><div class="prog-pct" id="progPct">0%</div><div class="prog-lbl">Complete</div></div>
                </div>
                <div class="prog-stats">
                    <div class="prog-stat"><div class="v" id="statDone">0</div><div class="l">Done</div></div>
                    <div class="prog-stat"><div class="v" id="statLeft">‚Äî</div><div class="l">Left</div></div>
                    <div class="prog-stat"><div class="v" id="statWeek">1</div><div class="l">Week</div></div>
                    <div class="prog-stat"><div class="v" id="statDay">1</div><div class="l">Day</div></div>
                </div>
                <div id="ctaArea"></div>
            </div>
            <div class="panel-card" id="nextCard" style="display:none;">
                <div class="panel-title">Up Next</div>
                <div id="nextContent"></div>
            </div>
        </div>
    </div>
</div>
<div class="wmodal" id="wmodal">
    <div class="wmodal-box">
        <div class="wm-hero" id="wmHero"><span id="wmIcon">üí™</span></div>
        <div class="wm-body">
            <div class="wm-title" id="wmTitle"></div>
            <div class="wm-meta"><span id="wmCat"></span><span id="wmCal"></span></div>
            <p class="wm-desc" id="wmDesc"></p>
            <ul class="wm-steps" id="wmSteps"></ul>
            <div class="wm-actions">
                <button class="btn-start-session" onclick="goToSession()">‚ñ∂ Start with Timer</button>
                <button class="btn-close-wm" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>
</div>
<script src="api.js"></script>
<script>
requireAuth();
const P=new URLSearchParams(location.search),PROG_ID=P.get('id'),EID=P.get('enrollmentId');
if(!PROG_ID)location.href='programs.html';
const FALLBACK=[
  {id:'prog-beginner',title:'Beginner Foundation',durationWeeks:4,daysPerWeek:3,description:'Perfect for beginners. Master fundamental movements and build a sustainable fitness habit over 4 weeks.',weeks:Array(4).fill(0).map((_,i)=>({weekNumber:i+1,title:'Week '+(i+1),days:[{dayNumber:1,title:'Upper Body',exercises:[{id:'ex-pushup',name:'Push-ups',category:'STRENGTH',caloriesPerMin:8,description:'Classic upper body exercise targeting chest, shoulders, and triceps.'},{id:'ex-dips',name:'Tricep Dips',category:'STRENGTH',caloriesPerMin:7,description:'Targets triceps using a chair or bench.'},{id:'ex-plank',name:'Plank',category:'CORE',caloriesPerMin:5,description:'Isometric core stability hold.'}]},{dayNumber:2,title:'Lower Body',exercises:[{id:'ex-squat',name:'Squats',category:'STRENGTH',caloriesPerMin:9,description:'Fundamental lower body compound movement.'},{id:'ex-lunge',name:'Lunges',category:'STRENGTH',caloriesPerMin:7.5,description:'Unilateral leg strength and balance exercise.'},{id:'ex-glute',name:'Glute Bridges',category:'STRENGTH',caloriesPerMin:6,description:'Hip extension activating glutes and hamstrings.'}]},{dayNumber:3,title:'Core & Cardio',exercises:[{id:'ex-crunch',name:'Crunches',category:'CORE',caloriesPerMin:5.5,description:'Classic rectus abdominis exercise.'},{id:'ex-jjack',name:'Jumping Jacks',category:'CARDIO',caloriesPerMin:8,description:'Full-body cardio coordination exercise.'},{id:'ex-plank',name:'Plank',category:'CORE',caloriesPerMin:5,description:'Isometric full-body stability.'}]}]}))},
  {id:'prog-hiit',title:'Fat Burn HIIT',durationWeeks:6,daysPerWeek:4,description:'High-intensity interval training to maximise calorie burn. For intermediate athletes.',weeks:Array(6).fill(0).map((_,i)=>({weekNumber:i+1,title:'Week '+(i+1),days:[{dayNumber:1,title:'HIIT Blast',exercises:[{id:'ex-burpee',name:'Burpees',category:'CARDIO',caloriesPerMin:12,description:'Full-body HIIT combining squat, push-up, and jump.'},{id:'ex-sqjmp',name:'Jump Squats',category:'HIIT',caloriesPerMin:14,description:'Explosive plyometric squat for power.'},{id:'ex-mclimb',name:'Mountain Climbers',category:'CORE',caloriesPerMin:11,description:'Dynamic core and cardio from plank.'}]},{dayNumber:2,title:'Cardio Day',exercises:[{id:'ex-hknees',name:'High Knees',category:'CARDIO',caloriesPerMin:10,description:'Drive knees to hip height in place.'},{id:'ex-bkicks',name:'Butt Kicks',category:'CARDIO',caloriesPerMin:9,description:'Kick heels toward glutes for hamstring work.'},{id:'ex-jjack',name:'Jumping Jacks',category:'CARDIO',caloriesPerMin:8,description:'Classic coordination cardio exercise.'}]},{dayNumber:3,title:'Sprint Day',exercises:[{id:'ex-sprint',name:'Sprint Intervals',category:'HIIT',caloriesPerMin:16,description:'Alternate max effort sprints with walking recovery.'},{id:'ex-boxjmp',name:'Box Jumps',category:'HIIT',caloriesPerMin:13,description:'Explosive jump onto a platform.'},{id:'ex-burpee',name:'Burpees',category:'CARDIO',caloriesPerMin:12,description:'High-intensity full-body exercise.'}]},{dayNumber:4,title:'Power & Core',exercises:[{id:'ex-sqjmp',name:'Jump Squats',category:'HIIT',caloriesPerMin:14,description:'Explosive plyometric squat.'},{id:'ex-mclimb',name:'Mountain Climbers',category:'CORE',caloriesPerMin:11,description:'Dynamic core exercise from plank.'},{id:'ex-plank',name:'Plank',category:'CORE',caloriesPerMin:5,description:'Isometric stability hold.'}]}]}))},
  {id:'prog-core',title:'Core Power',durationWeeks:4,daysPerWeek:3,description:'Focused 4-week core training to build a strong, stable midsection.',weeks:Array(4).fill(0).map((_,i)=>({weekNumber:i+1,title:'Week '+(i+1),days:[{dayNumber:1,title:'Stability',exercises:[{id:'ex-plank',name:'Plank',category:'CORE',caloriesPerMin:5,description:'Isometric full-body stability.'},{id:'ex-crunch',name:'Crunches',category:'CORE',caloriesPerMin:5.5,description:'Classic abdominal exercise.'},{id:'ex-lraise',name:'Leg Raises',category:'CORE',caloriesPerMin:5,description:'Lower ab raise to 90 degrees.'}]},{dayNumber:2,title:'Power Core',exercises:[{id:'ex-mclimb',name:'Mountain Climbers',category:'CORE',caloriesPerMin:11,description:'Dynamic core cardio combination.'},{id:'ex-rtwist',name:'Russian Twists',category:'CORE',caloriesPerMin:6.5,description:'Rotational oblique exercise.'},{id:'ex-plank',name:'Plank',category:'CORE',caloriesPerMin:5,description:'Isometric core hold.'}]},{dayNumber:3,title:'Oblique Focus',exercises:[{id:'ex-lraise',name:'Leg Raises',category:'CORE',caloriesPerMin:5,description:'Lower ab targeting.'},{id:'ex-crunch',name:'Crunches',category:'CORE',caloriesPerMin:5.5,description:'Rectus abdominis exercise.'},{id:'ex-rtwist',name:'Russian Twists',category:'CORE',caloriesPerMin:6.5,description:'Oblique rotation exercise.'}]}]}))},
  {id:'prog-strength',title:'Full Body Strength',durationWeeks:8,daysPerWeek:5,description:'Comprehensive 8-week bodyweight strength program with progressive overload.',weeks:Array(8).fill(0).map((_,i)=>({weekNumber:i+1,title:'Week '+(i+1),days:[{dayNumber:1,title:'Upper Push',exercises:[{id:'ex-pushup',name:'Push-ups',category:'STRENGTH',caloriesPerMin:8,description:'Chest, shoulders, triceps.'},{id:'ex-pike',name:'Pike Push-ups',category:'STRENGTH',caloriesPerMin:8.5,description:'Shoulder-focused push-up variation.'},{id:'ex-dips',name:'Tricep Dips',category:'STRENGTH',caloriesPerMin:7,description:'Tricep isolation using chair.'}]},{dayNumber:2,title:'Lower Body',exercises:[{id:'ex-squat',name:'Squats',category:'STRENGTH',caloriesPerMin:9,description:'Fundamental lower body strength.'},{id:'ex-lunge',name:'Lunges',category:'STRENGTH',caloriesPerMin:7.5,description:'Unilateral leg exercise.'},{id:'ex-glute',name:'Glute Bridges',category:'STRENGTH',caloriesPerMin:6,description:'Glute and hamstring activation.'}]},{dayNumber:3,title:'Core',exercises:[{id:'ex-plank',name:'Plank',category:'CORE',caloriesPerMin:5,description:'Full-body isometric stability.'},{id:'ex-crunch',name:'Crunches',category:'CORE',caloriesPerMin:5.5,description:'Abdominal exercise.'},{id:'ex-mclimb',name:'Mountain Climbers',category:'CORE',caloriesPerMin:11,description:'Dynamic core and cardio.'}]},{dayNumber:4,title:'Cardio',exercises:[{id:'ex-burpee',name:'Burpees',category:'CARDIO',caloriesPerMin:12,description:'Full-body HIIT exercise.'},{id:'ex-jjack',name:'Jumping Jacks',category:'CARDIO',caloriesPerMin:8,description:'Cardio coordination.'},{id:'ex-hknees',name:'High Knees',category:'CARDIO',caloriesPerMin:10,description:'Running in place for endurance.'}]},{dayNumber:5,title:'Full Body',exercises:[{id:'ex-pushup',name:'Push-ups',category:'STRENGTH',caloriesPerMin:8,description:'Classic push-up.'},{id:'ex-squat',name:'Squats',category:'STRENGTH',caloriesPerMin:9,description:'Classic squat.'},{id:'ex-plank',name:'Plank',category:'CORE',caloriesPerMin:5,description:'Core stability.'}]}]}))},
  {id:'prog-flex',title:'Mobility & Flexibility',durationWeeks:3,daysPerWeek:4,description:'Improve range of motion, reduce injury risk, and recover faster.',weeks:Array(3).fill(0).map((_,i)=>({weekNumber:i+1,title:'Week '+(i+1),days:[{dayNumber:1,title:'Morning Flow',exercises:[{id:'ex-ddog',name:'Downward Dog',category:'FLEXIBILITY',caloriesPerMin:3.5,description:'Foundational yoga stretch for hamstrings and shoulders.'},{id:'ex-hipfx',name:'Hip Flexor Stretch',category:'FLEXIBILITY',caloriesPerMin:2.5,description:'Kneeling lunge to open hip flexors.'},{id:'ex-child',name:"Child's Pose",category:'FLEXIBILITY',caloriesPerMin:2,description:'Restorative pose for hips and back.'}]},{dayNumber:2,title:'Hip Focus',exercises:[{id:'ex-hipfx',name:'Hip Flexor Stretch',category:'FLEXIBILITY',caloriesPerMin:2.5,description:'Opening tight hip flexors.'},{id:'ex-ddog',name:'Downward Dog',category:'FLEXIBILITY',caloriesPerMin:3.5,description:'Inverted V stretch.'},{id:'ex-child',name:"Child's Pose",category:'FLEXIBILITY',caloriesPerMin:2,description:'Restorative hip stretch.'}]},{dayNumber:3,title:'Recovery',exercises:[{id:'ex-child',name:"Child's Pose",category:'FLEXIBILITY',caloriesPerMin:2,description:'Rest and recover.'},{id:'ex-ddog',name:'Downward Dog',category:'FLEXIBILITY',caloriesPerMin:3.5,description:'Full body stretch.'},{id:'ex-hipfx',name:'Hip Flexor Stretch',category:'FLEXIBILITY',caloriesPerMin:2.5,description:'Hip opener.'}]},{dayNumber:4,title:'Full Mobility',exercises:[{id:'ex-ddog',name:'Downward Dog',category:'FLEXIBILITY',caloriesPerMin:3.5,description:'Inverted V pose.'},{id:'ex-child',name:"Child's Pose",category:'FLEXIBILITY',caloriesPerMin:2,description:'Restorative hold.'},{id:'ex-hipfx',name:'Hip Flexor Stretch',category:'FLEXIBILITY',caloriesPerMin:2.5,description:'Hip flexor opener.'}]}]}))}
];
const CI={STRENGTH:'üí™',CARDIO:'üèÉ',CORE:'üî•',HIIT:'‚ö°',FLEXIBILITY:'üßò'};
const HG=['linear-gradient(135deg,#667eea,#764ba2)','linear-gradient(135deg,#f093fb,#f5576c)','linear-gradient(135deg,#4facfe,#00f2fe)','linear-gradient(135deg,#fa709a,#fee140)','linear-gradient(135deg,#43e97b,#38f9d7)'];
const CG=['var(--g1)','var(--g2)','var(--g3)','var(--ga)'];
const STEPS={'ex-pushup':['High plank, hands shoulder-width.','Lower chest to floor, elbows at 45¬∞.','Push explosively back to start.','Keep body straight throughout.'],'ex-squat':['Feet shoulder-width, toes out.','Lower until thighs parallel.','Drive through heels to stand.','Chest up, knees over toes.'],'ex-plank':['Forearms down, elbows under shoulders.','Engage core, glutes, and quads.','Hold straight line head to heels.','Breathe steadily.'],'ex-burpee':['Squat, hands to floor.','Jump or step feet to plank.','Optional push-up.','Jump up, arms overhead.'],'ex-crunch':['Lie back, knees bent.','Curl ribs toward pelvis.','Lower slowly without fully resting.','Use abs, not neck.'],'ex-mclimb':['High plank, wrists under shoulders.','Drive knee to chest, switch.','Keep hips level.','Engage core every rep.'],'ex-lunge':['Stand tall, step forward.','Lower both knees to 90¬∞.','Push through front heel.','Alternate legs.'],'ex-ddog':['All fours, toes tucked.','Press hips up and back.','Straighten legs, heels down.','Hold 5 breaths.'],'ex-child':['Kneel, toes touching.','Reach arms forward on floor.','Forehead down, breathe deep.','Hold 5-10 breaths.'],'ex-hipfx':['Kneel one knee, other foot forward.','Press hips forward gently.','Torso upright, core engaged.','Hold 30-45 seconds each side.']};
let prog=null,enroll=null,activeEx=null;
async function loadAll(){
    LoadingManager.show('Loading...');
    try{
        const[pR,eR]=await Promise.all([ProgramsAPI.getProgramById(PROG_ID),ProgramsAPI.getUserPrograms()]);
        if(pR.success&&pR.data){prog=pR.data;if(!prog.weeks||!prog.weeks.length){const f=FALLBACK.find(p=>p.id===PROG_ID);if(f)prog.weeks=f.weeks;}}
        else prog=FALLBACK.find(p=>p.id===PROG_ID)||null;
        if(eR.success&&eR.data)enroll=eR.data.find(e=>e.programId===PROG_ID||e.program?.id===PROG_ID)||null;
        if(!enroll&&EID)enroll={id:EID,programId:PROG_ID,progress:0};
    }catch{prog=FALLBACK.find(p=>p.id===PROG_ID)||null;enroll=EID?{id:EID,programId:PROG_ID,progress:0}:null;}
    finally{LoadingManager.hide();}
    if(!prog){document.getElementById('heroTitle').textContent='Program Not Found';return;}
    renderHero();renderIncludes();renderWeeks();renderPanel();
}
function renderHero(){
    const p=prog,tot=(p.durationWeeks||4)*(p.daysPerWeek||3),idx=FALLBACK.findIndex(x=>x.id===p.id);
    document.title=p.title+' ‚Äì FlowFit';
    ['bcTitle','heroTitle'].forEach(id=>document.getElementById(id).textContent=p.title);
    document.getElementById('heroDesc').textContent=p.description||'';
    document.getElementById('heroBadge').textContent='‚ö° '+p.durationWeeks+'-Week Program';
    document.getElementById('hsDuration').textContent=p.durationWeeks||'‚Äî';
    document.getElementById('hsDays').textContent=p.daysPerWeek||'‚Äî';
    document.getElementById('hsSessions').textContent=tot;
    document.getElementById('heroBg').style.background=HG[idx%HG.length];
    document.getElementById('heroBg').style.opacity='0.4';
}
function renderIncludes(){
    const p=prog,tot=(p.durationWeeks||0)*(p.daysPerWeek||0);
    document.getElementById('includesGrid').innerHTML=`<div class="include-item"><span class="include-icon">üìÖ</span><div class="include-text"><h4>${p.durationWeeks} Weeks</h4><p>Duration</p></div></div><div class="include-item"><span class="include-icon">üéØ</span><div class="include-text"><h4>${p.daysPerWeek} Days/Week</h4><p>Frequency</p></div></div><div class="include-item"><span class="include-icon">üí™</span><div class="include-text"><h4>${tot} Sessions</h4><p>Total workouts</p></div></div><div class="include-item"><span class="include-icon">‚ö°</span><div class="include-text"><h4>Bodyweight Only</h4><p>No equipment needed</p></div></div>`;
}
function renderWeeks(){
    const weeks=prog.weeks||[],totalDays=(prog.durationWeeks||0)*(prog.daysPerWeek||0),pct=enroll?(enroll.progress||0):0,doneDays=Math.round(pct/100*totalDays);
    let dc=0;
    document.getElementById('weeksContainer').innerHTML=weeks.map((wk,wi)=>{
        const days=wk.days||[],ws=dc;
        const dh=days.map((day,di)=>{
            const gi=dc+di,isDone=gi<doneDays,isCur=!isDone&&gi===doneDays&&!!enroll,chips=(day.exercises||[]).map(ex=>`<span class="ex-chip">${CI[(ex.category||'').toUpperCase()]||'üí™'} ${ex.name}</span>`).join('');
            return `<div class="day-row ${isDone?'completed-day':''} ${isCur?'current-day':''}"><div class="day-num">${isCur?'‚ñ∂':isDone?'‚úì':di+1}</div><div class="day-info"><div class="day-title">Day ${day.dayNumber}: ${day.title||'Workout Day'}</div><div class="day-exercises">${chips}</div></div><div class="day-status">${isDone?'<span class="status-done">‚úÖ</span>':isCur?`<button class="status-current" onclick="openDay(${gi})">Start ‚Üí</button>`:'<span class="status-locked">üîí</span>'}</div></div>`;
        }).join('');
        const doneW=Math.max(0,Math.min(days.length,doneDays-ws)),wPct=Math.round(doneW/days.length*100);
        dc+=days.length;
        return `<div class="week-block"><div class="week-header ${wi===0?'open':''}" onclick="toggleWeek(this)"><div class="week-num">W${wi+1}</div><div class="week-info"><div class="week-title">${wk.title||'Week '+(wi+1)}</div><div class="week-meta">${days.length} sessions ¬∑ ${days.flatMap(d=>d.exercises||[]).length} exercises</div></div><span class="week-chevron">‚ñæ</span></div><div class="week-progress-bar"><div class="week-progress-fill" style="width:${wPct}%"></div></div><div class="week-body ${wi===0?'open':''}">${dh}</div></div>`;
    }).join('');
}
function getDayAt(idx){let c=0;for(const wk of(prog.weeks||[])){for(const d of(wk.days||[])){if(c===idx)return d;c++;}}return null;}
function openDay(gi){const d=getDayAt(gi);if(d&&d.exercises&&d.exercises.length)showModal(d.exercises[0]);}
function toggleWeek(h){const b=h.nextElementSibling.nextElementSibling;h.classList.toggle('open');b.classList.toggle('open');}
function renderPanel(){
    const p=prog,e=enroll,tot=(p.durationWeeks||0)*(p.daysPerWeek||0),pct=e?Math.round(e.progress||0):0,done=Math.round(pct/100*tot),left=tot-done,curW=Math.min(Math.floor(done/(p.daysPerWeek||3))+1,p.durationWeeks||4),curD=(done%(p.daysPerWeek||3))+1;
    const circ=376.99;
    document.getElementById('progRingFill').style.strokeDashoffset=circ-(circ*pct/100);
    document.getElementById('progPct').textContent=pct+'%';
    document.getElementById('statDone').textContent=done;
    document.getElementById('statLeft').textContent=left;
    document.getElementById('statWeek').textContent=curW;
    document.getElementById('statDay').textContent=curD;
    const cta=document.getElementById('ctaArea');
    if(!e){document.getElementById('panelTitle').textContent='Join This Program';cta.innerHTML='<button class="btn-enroll" onclick="enrollNow()">Enroll Now ‚Üí</button>';}
    else if(pct>=100){cta.innerHTML='<button class="btn-continue" disabled>‚úÖ Completed!</button>';}
    else{cta.innerHTML=`<button class="btn-continue" onclick="continueNow()">Continue: Day ${curD} ‚Üí</button>`;renderNextCard(done);}
}
function renderNextCard(done){
    const day=getDayAt(done);if(!day)return;
    document.getElementById('nextCard').style.display='block';
    document.getElementById('nextContent').innerHTML=`<div style="font-weight:700;margin-bottom:.25rem;">Day ${day.dayNumber}: ${day.title||'Workout Day'}</div><div style="color:var(--s);font-size:.82rem;margin-bottom:.75rem;">${(day.exercises||[]).length} exercises</div>${(day.exercises||[]).map(ex=>`<div style="display:flex;align-items:center;gap:.75rem;padding:.55rem;background:rgba(255,255,255,.03);border-radius:10px;border:1px solid var(--border);margin-bottom:.4rem;cursor:pointer;" onclick='showModal(${JSON.stringify(ex).replace(/'/g,"&#39;")})'><span style="font-size:1.1rem;">${CI[(ex.category||'').toUpperCase()]||'üí™'}</span><div style="flex:1;"><div style="font-weight:600;font-size:.85rem;">${ex.name}</div><div style="color:var(--s);font-size:.76rem;">${ex.category} ¬∑ ${ex.caloriesPerMin} cal/min</div></div><span style="color:var(--acc);font-size:.8rem;font-weight:700;">Preview ‚Ä∫</span></div>`).join('')}`;
}
function continueNow(){const tot=(prog.durationWeeks||0)*(prog.daysPerWeek||0),done=Math.round((enroll?enroll.progress||0:0)/100*tot);openDay(done);}
function showModal(ex){
    activeEx=ex;
    const cat=(ex.category||'STRENGTH').toUpperCase(),icon=CI[cat]||'üí™',gi=Object.keys(CI).indexOf(cat)%CG.length;
    document.getElementById('wmHero').style.background=CG[gi];
    document.getElementById('wmIcon').textContent=icon;
    document.getElementById('wmTitle').textContent=ex.name;
    document.getElementById('wmCat').textContent=cat;
    document.getElementById('wmCal').textContent='üî• '+ex.caloriesPerMin+' cal/min';
    document.getElementById('wmDesc').textContent=ex.description||'Perform with controlled form.';
    const steps=STEPS[ex.id]||['Start in correct position.','Perform with controlled form.','Rest between sets.'];
    document.getElementById('wmSteps').innerHTML=steps.map((s,i)=>`<li class="wm-step"><div class="wm-step-n">${i+1}</div><p class="wm-step-t">${s}</p></li>`).join('');
    document.getElementById('wmodal').classList.add('active');
}
function closeModal(){document.getElementById('wmodal').classList.remove('active');}
function goToSession(){if(!activeEx)return;const ex=activeEx,eid=enroll?enroll.id:'';location.href=`workout-detail.html?id=${encodeURIComponent(ex.id)}&name=${encodeURIComponent(ex.name)}&cal=${ex.caloriesPerMin||8}&cat=${encodeURIComponent(ex.category||'STRENGTH')}&programId=${PROG_ID}&enrollmentId=${eid}`;}
async function enrollNow(){
    if(!confirm('Enroll in "'+prog.title+'"?'))return;
    try{LoadingManager.show('Enrolling...');const r=await ProgramsAPI.enrollInProgram(PROG_ID);if(r.success){enroll=r.data;Toast.success('Enrolled! üéâ');renderPanel();renderWeeks();}
    }catch(e){Toast.error(e.message||'Enrollment failed');}finally{LoadingManager.hide();}
}
document.getElementById('wmodal').addEventListener('click',e=>{if(e.target===document.getElementById('wmodal'))closeModal();});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal();});
document.addEventListener('DOMContentLoaded',loadAll);
</script>
</body>
</html>
